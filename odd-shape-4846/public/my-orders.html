<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Orders</title>
  <meta http-equiv="Cache-Control" content="no-store" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {margin:0;padding:24px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;background:#fff6ec;color:#1f2933;}
    h1{font-size:2rem;font-weight:800;margin-bottom:20px;}
    .order{background:#ffd84d;border-radius:16px;padding:16px;margin-bottom:16px;}
    .order p{margin:6px 0;}
    a{display:inline-block;margin-top:20px;font-weight:600;text-decoration:none;color:#1f2933;}
    a:hover{text-decoration:underline;}
  </style>
</head>
<body>
  <h1>My Orders</h1>
  <div id="ordersDiv"></div>
  <a href="/">鈫?Back to Shop</a>

  <script>
    const tg = window.Telegram?.WebApp;
    if(tg){tg.ready();tg.expand();}

    const ordersDiv = document.getElementById('ordersDiv');
    const userId = localStorage.getItem('user_id');

    fetch(`/api/public/my-orders?userId=${userId}`)
      .then(res=>res.json())
      .then(orders=>{
        if(!orders.length){ordersDiv.innerHTML='You have no orders yet.'; return;}
        orders.forEach(o=>{
          const div = document.createElement('div');
          div.className='order';
          div.innerHTML=`<p>Order #${o.id}</p><p>Total: $${o.total_usd}</p><p>Status: ${o.status}</p><p>Created: ${o.created_at}</p>`;
          ordersDiv.appendChild(div);
        });
      });
  </script>
</body>
</html>

